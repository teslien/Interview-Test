<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Take Test - Interview Test Platform</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n            min-height: 100vh;\n        }\n        \n        .header {\n            background: rgba(255, 255, 255, 0.9);\n            backdrop-filter: blur(10px);\n            padding: 16px 0;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n            position: sticky;\n            top: 0;\n            z-index: 40;\n        }\n        \n        .header-content {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 0 20px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .timer {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .timer-display {\n            font-family: 'Monaco', 'Menlo', monospace;\n            font-size: 18px;\n            font-weight: bold;\n            color: #1a202c;\n        }\n        \n        .timer-warning {\n            color: #e53e3e;\n        }\n        \n        .progress-info {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        \n        .progress-bar {\n            width: 200px;\n            height: 8px;\n            background: #e2e8f0;\n            border-radius: 4px;\n            overflow: hidden;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            transition: width 0.3s;\n        }\n        \n        .video-monitor {\n            width: 128px;\n            height: 96px;\n            background: #1a202c;\n            border-radius: 8px;\n            position: relative;\n            overflow: hidden;\n        }\n        \n        .video-monitor video {\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n        }\n        \n        .video-status {\n            position: absolute;\n            top: 4px;\n            right: 4px;\n            display: flex;\n            align-items: center;\n            gap: 4px;\n        }\n        \n        .recording-dot {\n            width: 8px;\n            height: 8px;\n            background: #e53e3e;\n            border-radius: 50%;\n            animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.5; }\n        }\n        \n        .container {\n            max-width: 1000px;\n            margin: 0 auto;\n            padding: 32px 20px;\n        }\n        \n        .test-card {\n            background: rgba(255, 255, 255, 0.9);\n            backdrop-filter: blur(10px);\n            border-radius: 16px;\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n        }\n        \n        .test-header {\n            padding: 24px;\n            border-bottom: 1px solid #e2e8f0;\n            display: flex;\n            justify-between;\n            align-items: center;\n        }\n        \n        .question-info {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .question-number {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 8px 16px;\n            border-radius: 20px;\n            font-weight: 600;\n        }\n        \n        .question-type {\n            background: #e2e8f0;\n            color: #4a5568;\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            text-transform: uppercase;\n            font-weight: 600;\n        }\n        \n        .question-points {\n            color: #718096;\n            font-size: 14px;\n        }\n        \n        .test-content {\n            padding: 32px;\n        }\n        \n        .question-text {\n            background: rgba(255, 255, 255, 0.8);\n            padding: 24px;\n            border-radius: 12px;\n            border-left: 4px solid #667eea;\n            margin-bottom: 32px;\n        }\n        \n        .question-text h2 {\n            color: #1a202c;\n            margin-bottom: 12px;\n            font-size: 18px;\n        }\n        \n        .question-text p {\n            color: #4a5568;\n            line-height: 1.6;\n            white-space: pre-wrap;\n        }\n        \n        .answer-section {\n            margin-bottom: 32px;\n        }\n        \n        .answer-section h3 {\n            color: #2d3748;\n            margin-bottom: 16px;\n            font-size: 16px;\n        }\n        \n        .multiple-choice-options {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .option {\n            background: rgba(255, 255, 255, 0.8);\n            border: 2px solid #e2e8f0;\n            border-radius: 12px;\n            padding: 16px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        \n        .option:hover {\n            border-color: #667eea;\n            background: rgba(102, 126, 234, 0.05);\n        }\n        \n        .option.selected {\n            border-color: #667eea;\n            background: rgba(102, 126, 234, 0.1);\n        }\n        \n        .option input[type=\"radio\"] {\n            width: 18px;\n            height: 18px;\n        }\n        \n        .option label {\n            flex: 1;\n            cursor: pointer;\n            color: #2d3748;\n        }\n        \n        .text-answer {\n            width: 100%;\n            min-height: 200px;\n            padding: 16px;\n            border: 2px solid #e2e8f0;\n            border-radius: 12px;\n            font-size: 14px;\n            line-height: 1.5;\n            resize: vertical;\n            background: rgba(255, 255, 255, 0.8);\n        }\n        \n        .text-answer:focus {\n            outline: none;\n            border-color: #667eea;\n            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n        }\n        \n        .coding-answer {\n            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n            background: #1e1e1e;\n            color: #d4d4d4;\n            border: 1px solid #404040;\n        }\n        \n        .language-info {\n            background: #e2e8f0;\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            color: #4a5568;\n            margin-bottom: 12px;\n            display: inline-block;\n        }\n        \n        .navigation {\n            padding: 24px;\n            border-top: 1px solid #e2e8f0;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .btn {\n            padding: 12px 24px;\n            border: none;\n            border-radius: 8px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s;\n            text-decoration: none;\n            display: inline-flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .btn-outline {\n            background: transparent;\n            border: 2px solid #e2e8f0;\n            color: #4a5568;\n        }\n        \n        .btn-outline:hover {\n            border-color: #cbd5e0;\n            background: #f7fafc;\n        }\n        \n        .btn-primary {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n        \n        .btn-primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n        }\n        \n        .btn-success {\n            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);\n            color: white;\n        }\n        \n        .btn-success:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);\n        }\n        \n        .btn:disabled {\n            opacity: 0.6;\n            cursor: not-allowed;\n            transform: none !important;\n            box-shadow: none !important;\n        }\n        \n        .loading-screen {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(255, 255, 255, 0.95);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            z-index: 1000;\n        }\n        \n        .spinner {\n            width: 48px;\n            height: 48px;\n            border: 4px solid #e2e8f0;\n            border-top: 4px solid #667eea;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin-bottom: 24px;\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        \n        .hidden {\n            display: none;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"loadingScreen\" class=\"loading-screen\">\n        <div class=\"spinner\"></div>\n        <p>Loading test...</p>\n    </div>\n\n    <div id=\"testInterface\" class=\"hidden\">\n        <!-- Header with timer and video -->\n        <div class=\"header\">\n            <div class=\"header-content\">\n                <div class=\"timer\">\n                    <span>⏰</span>\n                    <div class=\"timer-display\" id=\"timerDisplay\">00:00:00</div>\n                </div>\n                \n                <div class=\"progress-info\">\n                    <span id=\"progressText\">Question 1 of 10</span>\n                    <div class=\"progress-bar\">\n                        <div class=\"progress-fill\" id=\"progressFill\" style=\"width: 10%\"></div>\n                    </div>\n                </div>\n\n                <div class=\"video-monitor\">\n                    <video id=\"userVideo\" autoplay muted></video>\n                    <div class=\"video-status\">\n                        <div class=\"recording-dot\"></div>\n                        <span style=\"color: white; font-size: 10px;\">REC</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Main Test Content -->\n        <div class=\"container\">\n            <div class=\"test-card\">\n                <div class=\"test-header\">\n                    <div class=\"question-info\">\n                        <div class=\"question-number\" id=\"questionNumber\">Question 1</div>\n                        <div class=\"question-type\" id=\"questionType\">Multiple Choice</div>\n                    </div>\n                    <div class=\"question-points\" id=\"questionPoints\">1 point</div>\n                </div>\n                \n                <div class=\"test-content\">\n                    <div class=\"question-text\">\n                        <h2>Question</h2>\n                        <p id=\"questionText\">Loading question...</p>\n                    </div>\n                    \n                    <div class=\"answer-section\">\n                        <h3>Your Answer</h3>\n                        <div id=\"answerContainer\">\n                            <!-- Answer interface will be loaded here -->\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"navigation\">\n                    <button class=\"btn btn-outline\" id=\"prevBtn\" onclick=\"previousQuestion()\" disabled>\n                        ← Previous\n                    </button>\n                    \n                    <div>\n                        <button class=\"btn btn-primary\" id=\"nextBtn\" onclick=\"nextQuestion()\" style=\"display: none;\">\n                            Next →\n                        </button>\n                        <button class=\"btn btn-success\" id=\"submitBtn\" onclick=\"submitTest()\" style=\"display: none;\">\n                            🚀 Submit Test\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        const API_BASE = 'https://prescreen-app.preview.emergentagent.com/api';\n        \n        // Get token from URL parameters\n        const urlParams = new URLSearchParams(window.location.search);\n        const inviteToken = urlParams.get('token') || 'mock-token-1';\n        \n        let testData = null;\n        let currentQuestionIndex = 0;\n        let answers = {};\n        let timeLeft = 0;\n        let timerInterval = null;\n        let testStartTime = null;\n\n        // Mock test data for demonstration\n        const mockTestData = {\n            invite: {\n                id: 'mock-invite-1',\n                applicant_name: 'John Doe',\n                applicant_email: 'john@example.com',\n                status: 'in_progress'\n            },\n            test: {\n                id: 'mock-test-1',\n                title: 'Frontend Developer Assessment',\n                description: 'Comprehensive test for frontend developers',\n                duration_minutes: 90,\n                questions: [\n                    {\n                        id: 'q1',\n                        type: 'multiple_choice',\n                        question: 'What is React?',\n                        options: ['A library for building user interfaces', 'A programming language', 'A database', 'A web server'],\n                        points: 1\n                    },\n                    {\n                        id: 'q2',\n                        type: 'coding',\n                        question: 'Write a JavaScript function that reverses a string without using the built-in reverse() method.',\n                        expected_language: 'javascript',\n                        points: 3\n                    },\n                    {\n                        id: 'q3',\n                        type: 'essay',\n                        question: 'Explain the difference between let, const, and var in JavaScript. Include examples and discuss their scope and hoisting behavior.',\n                        points: 2\n                    }\n                ]\n            }\n        };\n\n        // Initialize test\n        document.addEventListener('DOMContentLoaded', async () => {\n            await initializeTest();\n        });\n\n        async function initializeTest() {\n            try {\n                // In a real implementation, this would fetch from the API\n                // const response = await fetch(`${API_BASE}/take-test/${inviteToken}`);\n                // testData = await response.json();\n                \n                // For now, use mock data\n                testData = mockTestData;\n                timeLeft = testData.test.duration_minutes * 60;\n                testStartTime = new Date();\n\n                // Initialize video\n                await initializeVideo();\n                \n                // Load first question\n                loadQuestion();\n                \n                // Start timer\n                startTimer();\n                \n                // Hide loading screen\n                document.getElementById('loadingScreen').classList.add('hidden');\n                document.getElementById('testInterface').classList.remove('hidden');\n                \n            } catch (error) {\n                console.error('Failed to initialize test:', error);\n                alert('Failed to load test. Please check your connection and try again.');\n            }\n        }\n\n        async function initializeVideo() {\n            try {\n                const stream = await navigator.mediaDevices.getUserMedia({ \n                    video: true, \n                    audio: true \n                });\n                document.getElementById('userVideo').srcObject = stream;\n            } catch (error) {\n                console.error('Failed to access camera:', error);\n                alert('Camera access is required for this test. Please refresh and allow camera access.');\n            }\n        }\n\n        function startTimer() {\n            updateTimerDisplay();\n            timerInterval = setInterval(() => {\n                timeLeft--;\n                updateTimerDisplay();\n                \n                if (timeLeft <= 0) {\n                    clearInterval(timerInterval);\n                    alert('Time is up! Submitting your test...');\n                    submitTest();\n                }\n            }, 1000);\n        }\n\n        function updateTimerDisplay() {\n            const hours = Math.floor(timeLeft / 3600);\n            const minutes = Math.floor((timeLeft % 3600) / 60);\n            const seconds = timeLeft % 60;\n            \n            const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n            const timerElement = document.getElementById('timerDisplay');\n            timerElement.textContent = display;\n            \n            // Add warning class if less than 5 minutes remaining\n            if (timeLeft < 300) {\n                timerElement.classList.add('timer-warning');\n            }\n        }\n\n        function loadQuestion() {\n            const question = testData.test.questions[currentQuestionIndex];\n            \n            // Update header info\n            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1}`;\n            document.getElementById('questionType').textContent = question.type.replace('_', ' ').toUpperCase();\n            document.getElementById('questionPoints').textContent = `${question.points} ${question.points === 1 ? 'point' : 'points'}`;\n            \n            // Update progress\n            const progress = ((currentQuestionIndex + 1) / testData.test.questions.length) * 100;\n            document.getElementById('progressText').textContent = `Question ${currentQuestionIndex + 1} of ${testData.test.questions.length}`;\n            document.getElementById('progressFill').style.width = `${progress}%`;\n            \n            // Update question text\n            document.getElementById('questionText').textContent = question.question;\n            \n            // Load answer interface based on question type\n            loadAnswerInterface(question);\n            \n            // Update navigation buttons\n            updateNavigationButtons();\n        }\n\n        function loadAnswerInterface(question) {\n            const container = document.getElementById('answerContainer');\n            \n            if (question.type === 'multiple_choice') {\n                const optionsHtml = question.options.map((option, index) => `\n                    <div class=\"option\" onclick=\"selectOption('${question.id}', '${option}', this)\">\n                        <input type=\"radio\" name=\"q_${question.id}\" value=\"${option}\" id=\"option_${index}\">\n                        <label for=\"option_${index}\">${option}</label>\n                    </div>\n                `).join('');\n                \n                container.innerHTML = `<div class=\"multiple-choice-options\">${optionsHtml}</div>`;\n                \n                // Restore previous answer if exists\n                if (answers[question.id]) {\n                    const selectedOption = container.querySelector(`input[value=\"${answers[question.id]}\"]`);\n                    if (selectedOption) {\n                        selectedOption.checked = true;\n                        selectedOption.closest('.option').classList.add('selected');\n                    }\n                }\n                \n            } else if (question.type === 'coding') {\n                const languageInfo = question.expected_language ? \n                    `<div class=\"language-info\">Expected language: ${question.expected_language}</div>` : '';\n                \n                container.innerHTML = `\n                    ${languageInfo}\n                    <textarea \n                        class=\"text-answer coding-answer\" \n                        id=\"answer_${question.id}\"\n                        placeholder=\"Write your code here...\"\n                        oninput=\"saveAnswer('${question.id}', this.value)\"\n                    >${answers[question.id] || ''}</textarea>\n                `;\n                \n            } else if (question.type === 'essay') {\n                container.innerHTML = `\n                    <textarea \n                        class=\"text-answer\" \n                        id=\"answer_${question.id}\"\n                        placeholder=\"Write your answer here...\"\n                        oninput=\"saveAnswer('${question.id}', this.value)\"\n                    >${answers[question.id] || ''}</textarea>\n                `;\n            }\n        }\n\n        function selectOption(questionId, answer, element) {\n            // Remove selected class from all options\n            const allOptions = element.parentElement.querySelectorAll('.option');\n            allOptions.forEach(opt => opt.classList.remove('selected'));\n            \n            // Add selected class to clicked option\n            element.classList.add('selected');\n            \n            // Check the radio button\n            const radio = element.querySelector('input[type=\"radio\"]');\n            radio.checked = true;\n            \n            // Save answer\n            saveAnswer(questionId, answer);\n        }\n\n        function saveAnswer(questionId, answer) {\n            answers[questionId] = answer;\n        }\n\n        function updateNavigationButtons() {\n            const prevBtn = document.getElementById('prevBtn');\n            const nextBtn = document.getElementById('nextBtn');\n            const submitBtn = document.getElementById('submitBtn');\n            \n            // Previous button\n            prevBtn.disabled = currentQuestionIndex === 0;\n            \n            // Next/Submit buttons\n            if (currentQuestionIndex === testData.test.questions.length - 1) {\n                nextBtn.style.display = 'none';\n                submitBtn.style.display = 'inline-flex';\n            } else {\n                nextBtn.style.display = 'inline-flex';\n                submitBtn.style.display = 'none';\n            }\n        }\n\n        function previousQuestion() {\n            if (currentQuestionIndex > 0) {\n                currentQuestionIndex--;\n                loadQuestion();\n            }\n        }\n\n        function nextQuestion() {\n            if (currentQuestionIndex < testData.test.questions.length - 1) {\n                currentQuestionIndex++;\n                loadQuestion();\n            }\n        }\n\n        async function submitTest() {\n            if (!confirm('Are you sure you want to submit your test? You cannot make changes after submission.')) {\n                return;\n            }\n            \n            clearInterval(timerInterval);\n            \n            try {\n                // Prepare submission data\n                const submissionData = {\n                    answers: Object.entries(answers).map(([questionId, answer]) => ({\n                        question_id: questionId,\n                        answer: answer\n                    }))\n                };\n                \n                // In real implementation:\n                // await fetch(`${API_BASE}/submit-test/${inviteToken}`, {\n                //     method: 'POST',\n                //     headers: { 'Content-Type': 'application/json' },\n                //     body: JSON.stringify(submissionData)\n                // });\n                \n                console.log('Test submitted:', submissionData);\n                alert('Test submitted successfully! Thank you for completing the assessment.');\n                \n                // Redirect to success page or login\n                window.location.href = '/working-login.html';\n                \n            } catch (error) {\n                console.error('Failed to submit test:', error);\n                alert('Failed to submit test. Please try again.');\n            }\n        }\n\n        // Detect tab switching or window blur (potential cheating)\n        document.addEventListener('visibilitychange', () => {\n            if (document.hidden) {\n                console.warn('User switched tabs or minimized window');\n                // In a real implementation, you might want to flag this or pause the test\n            }\n        });\n\n        // Prevent right-click context menu\n        document.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n        });\n\n        // Prevent common keyboard shortcuts\n        document.addEventListener('keydown', (e) => {\n            if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'a' || e.key === 's' || e.key === 'u')) {\n                e.preventDefault();\n            }\n            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {\n                e.preventDefault();\n            }\n        });\n    </script>\n</body>\n</html>"